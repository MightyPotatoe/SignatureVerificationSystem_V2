function [Y,Xf,Af] = myNeuralNetworkFunction4(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-May-2017 19:59:12.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 48xQ matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 3xQ matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1032;0;0;0;983;5;5;6;1092;0;0;0;1047;3;4;3;1011;0;0;0;1061;0;0;0;1007;0;0;0;1058;0;0;0;965;0;0;0;971;2;9;0;1010;0;7;0;1006;0;0;0];
x1_step1_gain = [0.0104166666666667;0.0273972602739726;0.027027027027027;0.0377358490566038;0.00888888888888889;0.021978021978022;0.0229885057471264;0.0273972602739726;0.0151515151515152;0.0363636363636364;0.0357142857142857;0.0444444444444444;0.0119760479041916;0.0307692307692308;0.03125;0.0350877192982456;0.00938967136150235;0.0303030303030303;0.0303030303030303;0.0212765957446809;0.0122699386503067;0.0357142857142857;0.0357142857142857;0.0266666666666667;0.0105820105820106;0.0240963855421687;0.0285714285714286;0.037037037037037;0.0144927536231884;0.0350877192982456;0.0384615384615385;0.0476190476190476;0.00865800865800866;0.0253164556962025;0.0263157894736842;0.0256410256410256;0.00943396226415094;0.0240963855421687;0.025974025974026;0.0217391304347826;0.0111731843575419;0.0277777777777778;0.0307692307692308;0.0344827586206897;0.0105263157894737;0.0289855072463768;0.0289855072463768;0.0357142857142857];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.0507483952449361;-1.1855422417014256;-0.79436420490541526;-0.41658912434202949;0.024298397324798587;-0.39782853511570759;-0.13159483804649924;1.215322958596617;-1.2356024752609931;-1.357774997981708];
IW1_1 = [0.49324978358078736 -0.45448552940380421 -0.14402261563854873 -0.23935501158000452 -0.33691165265498335 -0.27776018636796618 0.3023234430460825 -0.10899588387938991 0.7973066382068662 -0.72269327638849268 -0.17009810858821783 -0.70489071051497509 -0.30327963571944649 -0.047822328711585996 0.42304411743032355 0.14362975531712033 0.0080959266060874023 -0.076963564661460482 -0.61965765599692868 -0.35584945132469942 -0.56971823917061659 0.56787626799920476 -0.0011945219797589812 0.083578310337421219 0.37852029254612951 -0.042413765208545909 -0.38890460468184435 -0.51281557986307169 0.44352284541040538 -0.56123694481522957 -0.20522708631811643 -0.68559285554703575 0.4236964412381099 -0.44072092375153354 -0.15688323068174359 -0.072087560710910423 -0.23608239126964475 0.52814800101930248 0.3045238352172433 -0.18259473701964898 -0.26706646582286403 -0.10039287526352308 0.39737930238901092 0.0019131037805830333 -0.44124491883539224 -0.0029305703252842231 0.54349067633934989 -0.026654125677952886;-0.01222632605199417 0.69613341947746332 0.62026131305450583 -0.15894954840454101 -0.21621548934667795 0.16457085653629777 0.48464246340599026 -0.66948990269742836 0.326956865595456 -0.34582258048301384 0.36162619397931456 -0.022700567913686971 -0.32234962142373824 0.19998348287164178 -0.19230733282480841 -0.24136335562814204 -0.01636756925119548 0.34183260540082 0.036165791910783125 -0.43069372118451177 -0.085665498974710069 -0.2118974581438384 0.18570619974262317 0.11702318762039593 -0.0082135971138240088 0.44754721431098771 0.042154015117695544 0.17087874135744216 -0.075993895543621279 -0.32271197241319832 0.21732475711040583 -0.47298874853752138 0.16063230507380885 -0.21689576751432399 -0.295764271854491 -0.48835125061099566 0.54326614369925008 -0.64023390537833769 -0.76280078429522691 -0.35267160350390847 -0.2637841790203293 -0.34404964648530117 -0.26162119870289097 0.50472882806938402 0.39412674483110083 -0.20787347398406905 -0.16477257294982364 0.21886351909592491;-0.027353324548897166 -0.033694254721121066 -0.057242042748630921 -0.15241590930414289 -0.017199730694114752 0.17415192556717157 -0.2263629573818354 -0.60376578036613493 -0.087979202437363652 0.14523851131746585 -0.076488242320858518 0.032658896116837186 0.033190758988242627 0.030321756237931978 0.41607248432150101 0.2315437114923877 0.25943606395346469 -0.033277764423711137 0.18673363638066157 -0.075342921371201965 -0.2073622129364191 -0.2299032566222049 0.1211934357151251 -0.17448070102408547 0.088926590050600274 -0.16309064268788881 0.12795687534123237 -0.18932981973891921 0.26784476176175753 0.015673609109414888 -0.18336237789993498 0.25038270907209864 0.21463487336599762 0.44101459263695603 -0.11024449360311989 -0.35712357075756151 0.039675117996868021 -0.40920062919303923 -0.13565952896842223 0.020653091813318376 0.27579475561742428 -0.23561193139996289 -0.41004565361031059 0.41468836507753232 0.026724547866302673 0.079376639783929365 -0.4570395115604699 0.32437458428659433;0.50030971820334535 -0.70122333587144148 -0.69987133559909431 -0.27246728913187029 0.20763862397255212 0.082543103416169467 -0.10335973029545256 0.51194255519560306 -0.45171433797280985 0.41060527489820053 0.19032857003668985 0.14186962776963022 0.084188583398816477 -0.13989518963996916 -0.11603175347392884 0.28008650618205705 -0.17936470037330937 0.70811858512128867 0.20773664316994087 0.70060997158568794 -0.046359042261557439 0.27794189035546346 -0.143109534340911 0.12256383773397347 0.36590069339699061 0.038656958268084914 0.03793617159751396 -0.61405677707708817 0.33694871476457733 -0.061472361082290462 0.15203249658664428 0.20615958691253258 -0.14100218051502839 0.66200724405012534 -0.10470101621016052 0.31003146136177595 -0.17361621714548989 0.050344777525731833 0.052020303049041164 0.17901257352969521 0.16263524050893743 0.32818062178187318 0.26544067240720731 -0.18054612994605129 0.22131286456775645 0.025954351109230889 -0.35183186197740912 -0.37738943477495912;0.39939107759777337 -0.3170896061397297 -0.15351100947590288 0.095170546854753207 -0.02031161253537812 0.33465248327719072 -0.34155940835314491 -0.13350288018028686 0.13449517421717574 -0.043813462297955269 0.28993912836021718 0.1377561955761171 0.13126602842153007 -0.26412927349100951 0.060464253528086535 0.15071543897133483 -0.53985649875071107 0.38266941491628598 0.27804159575102411 0.039607342622171825 0.22418195927519322 0.15795712721969699 0.24439916134497633 -0.082211646185735843 0.4253346747163983 0.016380474900093082 -0.40845065036305556 -0.23882703420571139 -0.25267635012275125 0.1398420696688836 0.10833258989974258 0.2477871456217286 0.051984225883822614 0.55609257967550207 -0.13309806763976292 0.043985835289906128 -0.024110238484390187 -0.16149164836947819 -0.14319015396052731 0.17832268222974576 0.16093088444338915 0.091047359015170012 0.46248658236125395 0.033681384349947621 0.15722422368100405 -0.17910189193667134 -0.10785463732664734 -0.46645242195464515;0.36993492580112775 -1.0261478975218157 -0.7457941959044283 0.31828193409453009 0.13020010185152567 -0.49247402655174793 -0.43394553583962958 1.0835764797369682 -0.17411612177507635 0.068945338188900085 0.2824428616453637 -0.12362376921171409 0.19630691303080905 0.011955680531798938 -0.12788054901261098 0.077207494904646387 -0.27389794206722484 0.6978559616883635 0.51750400196664303 0.44534992031419973 0.43275165965776635 0.34148802604061695 0.28886327734011435 -0.021842735109566538 0.47003317600363576 0.0317818944381692 -0.37243976845955301 -0.86597163845846614 -0.32088813863091087 0.27273241041090829 -0.064001778756850577 0.46317507731002788 -0.42128595254994922 0.66222607694578206 0.031312833940669915 0.45780515007258732 -0.44205088557138378 0.29121105831222877 -0.050353145847155223 0.55064593216440716 -0.22335348842703462 0.41090427446433342 0.099696293922433829 -0.042177247507190464 0.35449836374890298 0.16809996362781759 -0.12699842772454906 -0.48373811107150599;-0.47386598680146552 0.54435618771563477 0.20395306032498689 -0.25623021810603203 -0.20471596550728313 0.4519894159474554 0.091182079981236661 -1.109918130936582 -0.21646163931848297 0.45773053593969676 0.38402254834249283 -0.49424003663785365 -0.3181945354425994 0.49764405855066934 -0.056173632885002774 -0.33088125533701668 -0.2275141833976059 0.52852661988304006 0.61097400780521927 -1.0265697100334177 0.31942777764490066 0.18913622379958314 -0.25378113723526102 0.021603696929666707 -0.22100385135445746 0.12929652494435173 -0.29599167844765173 0.25763876901429184 -0.12681707415897636 0.13311691792018296 -0.055818429658627614 0.15654629588600524 0.50803092083013202 0.28835692859538764 0.34679980816895706 -0.55426630937946042 0.59256404089030079 -0.93547771308037952 -0.43774593038143783 -0.095090363229048985 0.46818310312971945 -0.71166408470089981 -1.0541636857354428 0.75676982842672691 0.12773085291114517 -0.65607584877084835 -0.4087213849159167 0.42484912078565357;0.059774625339109419 -0.067620728092426252 -0.13155270731062108 0.22357304679649143 0.18110183309422853 -0.33924250597703082 -0.072549620999054557 -0.086403046506919698 0.0017728852308357707 0.4097096441953566 0.27475154375301131 0.01757825246651926 -0.10321281512794141 -0.03551511849038079 0.42279168768797415 0.25220654200070403 -0.48119232455189193 0.72946905391712502 1.0389846653832804 -0.26150604696336438 -0.097771845579237279 0.12696561699499398 -0.34066436172255277 -0.45388714841110334 0.30719736316090945 0.1178755157623967 -0.044842631486454593 -0.46096537819799721 -0.43404986958872788 -0.20429001513649947 0.054077452924011088 -0.11346140438987933 -0.21836780209967807 0.22922157973045804 0.2252791373261962 0.081249266889205127 0.061566603369225932 -0.77842517624716057 -0.50684969065232155 -0.28641761727728077 0.30258574981315478 -0.029624055283056373 -0.60665268635372649 0.3799635890086458 0.27765310758895284 -0.32847688584304774 -0.36324833709022231 -0.18071769457630477;-0.2341664053348935 -0.20998372873907578 0.22351522895962098 0.27118533598667444 -0.044485511854121564 0.17331836781436244 -0.23537558721076504 0.37535762950338675 -0.26406602798687878 0.22471819978775556 -0.027530547750030446 0.34052126198637461 0.19740761382249059 -0.25358987393071769 -0.39165883620061692 -0.3321972798365862 0.17273354382829803 0.26041001226924032 0.001593963638469306 0.36028060149963725 0.19037144309178208 0.30575828044977499 -0.21140897990071131 -0.19553426456170747 -0.11995124505540286 0.007366644460006606 -0.098615413336427121 -0.097649812241597675 -0.2364047163579259 0.23335438104136136 0.31007099572414626 0.24607617734510076 -0.16069937436425685 -0.18621240078817433 -0.25900874840475102 0.14485862198357879 -0.059886028242330913 0.28534340281502946 -0.22264212940161138 0.22702437535438919 0.17427580725467545 -0.10707547075573956 0.0087336483750816828 -0.17957093945867472 0.077652923555824371 -0.16563544018227866 -0.19866649698582992 0.16725313952102838;-0.31647826180418748 0.15805715493218003 -0.18872506722374513 -0.16840260786451255 -0.21451817011710952 0.25909376087183533 0.29727730813347591 0.21775416662499567 0.10945062182488077 0.12511873989729552 0.0038209913242621325 0.095652544825825928 -0.37534597971942218 0.42160549708209055 -0.012999769849641496 0.073386275475710389 -0.27479178232593066 -0.38661802044137256 -0.15397807047185216 -0.16308771152984847 -0.45952517730470338 0.054866894420798597 0.42144466849092616 0.48642236029706992 -0.10697122846230807 0.28438370629989063 -0.3291009589264019 0.16714598345017218 -0.13703425597195446 -0.24921670523426842 -0.25760570296365748 -0.032005157287258008 -0.15216715875142511 0.028355880007119433 0.026942497789846382 -0.054500843316533119 -0.37449018531597328 -0.1106260339647487 0.24874055317904517 0.13305498902571922 -0.050650053181389675 0.13847255115815918 -0.28783875882094162 -0.19772313435525718 0.036201631552314283 0.20511218928984115 0.15233658540294923 0.25563443300069366];

% Layer 2
b2 = [-0.011283115921364963;-1.0282391440779519;-1.0272334988930041];
LW2_1 = [-0.5421326161812291 -1.5347458854200258 -0.10306359491262426 2.2024448106522905 1.4458217677361174 3.2351749622571817 -0.90361138424099841 0.92880931400263078 0.67383932349831976 -1.00060110466598;0.47040227473041096 0.090663523436828569 -0.4133283957921548 -1.1087508798826045 -0.56371304551893298 -2.3367814482869527 -3.0472226728278988 -2.7800058878700886 0.51460399180046068 0.74876054123327962;-0.65000252168453343 2.208214741151211 0.59074145860298144 -0.89779624697713678 0.14344748079169231 -2.0618062532821546 3.0253583556004848 2.1917061566786891 -0.80872140455550279 0.16087419744194814];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n)
nmax = max(n,[],1);
n = bsxfun(@minus,n,nmax);
numer = exp(n);
denom = sum(numer,1);
denom(denom == 0) = 1;
a = bsxfun(@rdivide,numer,denom);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
