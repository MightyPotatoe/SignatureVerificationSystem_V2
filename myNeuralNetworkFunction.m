function [Y,Xf,Af] = myNeuralNetworkFunction(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-May-2017 20:37:28.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 16xQ matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 3xQ matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [31;188;0;44;16;2;16;2;4;-7;-30;11;26;6;121;39];
x1_step1_gain = [0.0487804878048781;0.00829875518672199;0.166666666666667;0.0408163265306122;0.0555555555555556;0.0138888888888889;0.181818181818182;0.0344827586206897;0.166666666666667;0.133333333333333;0.0285714285714286;0.0909090909090909;0.00900900900900901;0.00677966101694915;0.0132450331125828;0.0416666666666667];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.6393683594071493;1.4351855009128573;1.4221636756672977;1.1463446692422639;1.1706889939068954;-0.87938140324088276;1.2245496312085424;0.75458735496177898;0.80212238563673488;-0.62372165991737083;0.084844052450500584;-0.32101123936422299;-0.2106375972957642;-0.15905400424035313;0.11524351108986754;-0.3007120133697746;0.37544948685705259;0.53233023923669032;-0.59221916013195364;-0.73706606659434259;1.0712131612854812;-1.0530876713744373;-1.2514736297504598;-1.346847505980918;-1.3692937610278049;1.7043943484228334;-1.7336399579696768];
IW1_1 = [0.20176451075662852 -0.44762673938130937 -0.34314476339623989 0.30521090194110084 -0.62322408930063578 -0.42469417745690263 0.73562397338871932 0.43669130361204939 -0.010749765031064607 0.3261285148940089 0.19676525610476039 0.116957838269277 0.67305342310343086 -0.51406866519709071 0.52637730889545442 -0.49810954937672847;-0.90632554166481771 -0.33319861132786688 -0.012318215856306679 0.30650174187377632 0.38881624569035339 0.40611335985039787 -0.68923646557947538 -0.14790891145608528 0.81334478236289132 -0.1440388804546984 0.0063052470447807259 0.131426820320941 0.095305484445820196 -0.36039211413628741 1.1176151099261247 0.27492735834512938;-0.020681840755745112 -0.27554257869925847 -0.58789180299563115 -0.12523398333678698 -0.62142309777360538 0.70226648824575333 -0.44810183295436423 0.24765878284430309 0.16820936569217559 -0.64596313260781046 0.32308445383422124 0.48373686861152881 -0.71733616770459563 0.34665130500210756 0.21522899011934923 0.074300226781298662;-0.24753425149491992 -0.032094282949240473 0.19467056278515327 -0.033910294621771475 -0.6097339951286147 -0.4029254518508093 -0.035374117313884776 -0.69679173449367027 0.17864784164124511 -0.075776707587366959 -0.81181306424060196 -0.4825865931901695 -0.6437316725693244 0.51859954488755045 0.86985381283047147 -0.072355594136857784;-0.54993740460044449 -0.65227729203350526 -0.43760066271571552 -0.060384825072253179 -0.83171144476553371 0.39364279605653735 -0.68477196364634785 0.19461937962714099 -0.1142207032716859 0.32303864047791958 -0.25782008622134267 0.3862943103387434 -0.45871277698841534 0.58549622602565898 -0.037141968483339352 -0.28476300882024536;0.021306425565458829 -0.063994268164806703 0.14430974511351102 -0.42320462900713074 0.031291657399237567 -0.040398931058859215 -0.28844224160508108 -0.48739430842471498 -0.15045607198975391 0.76927525225929982 -1.1096671770272988 0.239608589038138 0.70420182221301864 -0.48904192613467135 0.4690013705172637 0.48670300150560147;-0.45927548277471403 -0.63925508616808435 -0.30110982684708748 -0.33294216393183451 -0.44537880294307636 -0.32181242961752382 0.044417491346715861 -0.12486449223892188 0.67147106218873465 -0.37251695249312655 0.31328150398943339 0.030593525606945501 0.21563951492681688 0.17858698622662977 0.64151118364093795 -0.51203088273689601;-0.83280245799546571 -0.17718188549977451 -0.54346492768809695 0.38917520483687279 0.26675864062368493 0.52908274757413454 -0.24657293709269848 -0.88991184031603254 0.50407039993877378 0.27907426717103651 -0.10923778791996532 -0.039679016418326316 -0.34725705351552288 0.42348630388476366 -0.39446352400522 -0.039723841039614051;-0.36115654878960934 0.15092498656233896 -0.67330034542135364 -0.42130061848113481 0.8775604859725894 0.27979798048484572 0.245540843298513 -0.4307376026684322 0.42010432567486927 0.59914600558075048 -0.51399438813410336 -0.37585842175598427 -0.50567706172659721 0.0076362407128458681 -0.64987480186941848 0.59632356195051739;0.75084520149342215 -0.17123101057037723 0.12000015254237346 -0.61920137113150786 0.15816780212478149 -0.57009680244683969 -0.12319442400562627 0.57729889849982485 -0.11680637980893391 0.25106737713894728 -0.10227404592509839 -0.9279255265696027 0.56945678467287952 -0.28422639225655177 0.35226769674921421 0.056147284001774676;-0.41616787277655815 0.28527288313158639 0.29959721337181977 0.17161537114229086 0.77734172005841429 0.63737674447195791 -0.31150475662709443 0.60646255135150673 -0.34414071376332583 -0.78146983848489804 -0.12176510045300647 -0.054214675633063154 -0.060238548890668819 0.6082696784134719 0.30791032760001025 -0.87132423217150712;0.38046296067418645 -0.046378165066243981 -0.065545374778996329 0.42746727591608114 0.2558690432731755 -0.67450676764896589 -0.76280455712334871 0.47649559481577614 -0.038473845280318802 -0.42040167581619964 0.61372728574439794 0.085281528628621345 0.63942733134585295 0.51588973150684592 -0.53067721133805634 0.0059069109606591334;0.34190709150451154 0.20069004058617243 -0.33743845918183046 0.59081302643400413 -0.67400336311768017 -0.09356100665863383 0.44917317681091506 -0.20284022975699015 -0.5738780037909007 -0.10329095457302309 0.55220578097288309 0.55310122975568654 0.2609530968732981 -0.30635844711779187 -0.36312449213656939 0.57426951884373101;-0.3699682392176552 0.29350449314481403 -0.61283047066555607 0.89509818005406783 0.66827721618302749 0.11338913451810953 -0.64765695059401562 -0.028399170626899173 0.91490846777826196 -0.11776860658311693 -0.62538189509890629 -1.1718807025839202 -0.10326228931066514 -0.59698876530908529 0.08382649805229557 -0.19962770972730159;0.31144869491613492 0.55827330866189073 0.23865118432313587 0.15097334316942906 -0.3822017052165676 -0.46169596466944962 0.19608204108601149 -0.30068171280955081 -0.49705102515930344 0.64404439575311656 -0.35889126170963664 -0.5465762000723513 -0.3212117442740719 0.38149435031638751 -0.67050661380836363 -0.21419311596278889;-0.10296145294159036 0.73074895897431225 0.11697915053310166 0.18728100134240638 -0.094289809615410072 -0.71695570740272918 -0.68350566541497115 0.13862056257398531 -0.79676437334695316 0.54269931346243838 -0.18952600830383842 -0.34132664239063359 -0.018322456592401438 -0.14768107804020594 -0.017303125312061803 -0.62279610853109479;0.47871398375421326 -0.11713009645371536 0.14463769211406338 -0.4179442778287038 0.012909676992882228 -0.68183417386068756 -0.23007185212209838 -0.44177462386559735 -0.21508892121694856 -0.26400059117479219 -0.51451427244243275 0.45756956564027773 0.77063878537795361 -0.22126968465340943 -0.41120790434184107 0.64173859731631788;0.24051322888137841 0.6358396730060899 -0.14163273453290628 -0.019140373120977692 -0.59339645145850184 -0.48393878337519974 0.60663750099344038 0.051725193001800188 0.48339972778346185 -0.16618360318554767 -0.1835071627960834 -0.49536528356922416 0.60703831588762847 -0.37883684876086282 -0.51359753603006364 -0.52115436401471182;0.20989644116996992 0.11239354212713323 0.28860815779492005 -0.32779371508059219 -1.0000135175543403 -0.47189536921179309 0.58878341118681388 -0.46684031357615846 -0.17942623756696299 -0.54433974499081728 0.51354905374711235 0.82884683844587881 0.36880220297118116 -0.27131081402528318 0.8560459403828482 0.94126226676345581;-0.30832409067508804 0.25005950647199826 -0.010338523967241948 0.56601102064044073 0.68088796467084212 -0.73944734703076709 -0.19546827230809047 -0.59664992381993831 0.28766671747229761 0.15115351579689346 -0.22916097018956796 -0.25426084491849527 0.72941388506375215 0.39659206469283459 -0.0092831871732801073 0.46779673727365662;0.6512664290032919 0.37698026592364803 0.26164128338921688 -0.1955228810957037 0.27511090724073767 0.39985660512793086 -0.6731213368492901 -0.64215171024612039 -0.35270938925086526 -0.013479211265236386 0.27834208705867491 0.0040586903870709831 0.57500226168895641 -0.25641268742861767 -0.57663858290749237 0.060450406443599614;-0.22486258021389721 -0.79411930327440194 -0.50564727769571949 -0.46182213925918031 -0.65444078201831268 0.026548486813894281 -0.5790824257902718 0.53729653148123346 0.27924549259072845 -0.46832180201293583 -0.37617928083044394 0.41804549127007168 0.55864801238155715 0.10065632914417512 0.25532131185958901 -0.32648719485108102;-0.15609027896075212 -0.64333165415101823 0.53652137349054407 0.13836967837696543 0.29035066425259809 -0.35190977861102585 -0.52596722793521156 -0.11987589761183931 0.49846492386167768 -0.6912585796363635 -0.42414895118681079 0.0010689600310310465 -0.62571758343250572 0.43883930408288013 -0.35837751591528832 -0.02930275966273908;-0.28788308666801171 -0.12174953716086072 -0.19409973387301765 -0.43967257066267584 0.14247940391118089 0.26590211867202951 0.43329630129722196 -0.015502746211781594 0.49295016809205988 -0.18705341148533958 -0.63279278703773534 0.3261805596882193 0.47475683536955482 0.81107466457590083 0.80016869998768103 -0.18332576060795833;-0.18020139745145122 -0.23307169921225285 0.19355565682709042 0.57655458010253202 -0.21233611267650135 0.40961273219998706 -0.58248054475987698 0.70065050084545033 0.092016781700120592 -0.76904146102695814 0.3869973809550285 0.17025877167581149 0.71605472540112736 -0.39958917859182852 -0.012442180651441963 0.52083053435392346;0.06107160742918482 -0.4618006591838783 -0.46004866127798061 -0.60695399074759271 -0.57752245222637311 -0.52007143535234113 -0.15411523768127997 0.84034515572987756 0.033146024631471677 0.24099156730739926 0.089037698430375123 0.1072760671575823 -0.42985016513463514 0.51099187737668572 -0.07576348878577216 -0.47169795044969542;-0.39710260686156967 -0.58417384169710684 0.3665905342424649 -0.44263715610541621 0.47589819442659675 -0.50534064917988386 0.75172105911838838 0.55729852454040141 -0.02979310927621838 0.21279649570500461 0.26043347465575106 -0.23591326812532756 -0.51595842415045856 0.27768773300546234 0.54046798421356879 0.18045116781768739];

% Layer 2
b2 = [-0.63784125366669964;0.86261081198409073;0.11418375882174027];
LW2_1 = [-0.23835704732733745 -0.74948094020152933 -0.6219815518038454 -0.8848688529099783 0.31603229071235295 -0.87547048979469544 -0.37373654787641719 -1.115665042808609 -1.3693653379508857 0.39736372997773367 1.0947214525791416 0.50749108779202234 0.30575525636632001 -0.92471812627740624 -0.34631843999701867 0.074990988708884335 -0.52916829686201972 -0.16358191204627409 -0.6896226691906896 0.26945183202815198 -0.51131911247701911 0.75446284250882423 0.5288140291936656 -0.65597042289411167 0.59855946781856273 1.1461902162260265 -0.69122771766108249;-0.77259100773028633 0.44815504457607813 -0.96955682375785579 -0.61886442353166582 -0.49714975921476778 0.38312093599052044 0.031282550347182844 -0.51701300583952925 0.6173797830342318 0.86815798785163445 -0.47152246566455697 -0.97604858859342103 -0.18374029922790663 1.2673900055620528 -0.15628850115361692 -0.62974255405018886 -0.69270908136605935 0.25110149916437918 -1.3652485010707143 -0.19666825111932779 0.1054637262653802 0.15941821167109124 -0.19614944126147976 -0.43095001283183537 0.27020862017041813 0.56265837185192824 0.78799608009150224;0.28967769882651795 0.50232166714869064 -0.64768244236521866 0.077719874423343049 0.91636764968937867 -0.86881496801340174 -0.87105605107990514 -0.54223511057062579 -0.59883967833599339 -0.017285422258061848 -1.3100090843276972 0.16766470043304457 0.55745747486828079 -1.196184801832699 -0.47199805864600752 -0.59579423272942722 -0.31509245881663461 0.13922439034595305 1.5592909976346059 -0.76073144589136577 -0.19296553550303377 -0.3748345607417452 0.26871168919972843 0.054069037381499686 -0.65400776215021073 -0.54586837654884701 0.43760961468450449];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n)
nmax = max(n,[],1);
n = bsxfun(@minus,n,nmax);
numer = exp(n);
denom = sum(numer,1);
denom(denom == 0) = 1;
a = bsxfun(@rdivide,numer,denom);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
