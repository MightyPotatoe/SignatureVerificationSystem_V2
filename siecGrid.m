function [Y,Xf,Af] = siecGrid(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 29-May-2017 13:37:03.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 96xQ matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_remove = [13 17 19 23 26 29 31 34 37 38 39 41 43 46 47 51 52 53 57 58 59 61 62 65 67 68 69 71 73 74 75 76 78 79 81 82 83 85 86 87 89 90 91 92 93 94 95];
x1_step1_keep = [1 2 3 4 5 6 7 8 9 10 11 12 14 15 16 18 20 21 22 24 25 27 28 30 32 33 35 36 40 42 44 45 48 49 50 54 55 56 60 63 64 66 70 72 77 80 84 88 96];
x1_step2_xoffset = [-0.805046552486244;-0.446934861708126;-0.411066133922473;-0.588441565729081;-1.19211432412605;-1.18132122304505;-0.964631112693016;-0.742877748775568;-1.06076292949688;-0.650530777209026;-0.41453901251688;-0.725224481965663;-1.43872355681064;-0.342659676786539;-0.814849825348422;-0.492490255291823;-0.534659117365016;-0.979911474957309;-0.699686550506732;-1.07346000085492;-0.293932821982509;-0.631269830207039;-0.609485234465225;-0.850469747597413;-0.964521321056071;-0.888438586883028;-0.67664042054571;-1.06429911938162;-1.08861912273254;-0.672788726147487;-0.701328297595614;-0.47589031780764;-0.931371844478301;-0.649609716741926;-0.408438868453443;-0.460823411000631;-0.751389728762146;-0.912481752597857;-0.823192876777429;-0.664441976087654;-0.591117524193485;-1.00069770394726;-1.14608308618836;-0.674727234280271;-0.904556270188513;-1.12213394524736;-1.02033867602176;-1.17175051807915;-1.05755324783605];
x1_step2_gain = [0.0309216037925972;0.0423049452527144;0.0389287431837365;0.0339780815279707;0.0318613116276613;0.0324563515617334;0.0332079767291502;0.0502317923880188;0.0501466722126274;0.0285313281390327;0.0774317790918122;0.0342321275991746;0.0312660555495489;0.0330287755571602;0.0572130983708892;0.0343936715271359;0.0328642593589773;0.028510210205412;0.057540635893417;0.0380293657445522;0.0295682959943303;0.0381433385349096;0.0337626681467106;0.0346266073226476;0.0562675946864496;0.0410498795915596;0.0334410295765101;0.0276156780717139;0.0348422335405258;0.0296647239612886;0.0319155438022012;0.0323767105827934;0.043632420817926;0.0383995274020223;0.0304407945419568;0.0297967482119357;0.0283377204596986;0.0454560187507399;0.0313325577028203;0.034027054065842;0.0375960077067748;0.0297133315213224;0.0271969088141325;0.0420734393390018;0.0309239578770215;0.0549817966647981;0.0324810747625802;0.0309189246384439;0.0270072468429159];
x1_step2_ymin = -1;

% Layer 1
b1 = [-1.4386573118130994;1.1946691112360455;-0.90255485109189337;-0.54847826126430188;-0.16376092343496931;-0.065699977130272591;0.49325906801016012;0.93730710160788622;1.2176280908926518;1.5147751521429813];
IW1_1 = [0.065586334214094585 0.12686521938240888 -0.27423571052195755 -0.21586477862922898 -0.20959123489637238 0.055022670236457356 0.0018568891727735221 0.064269803640236003 0.18864367581602753 0.3557096185489797 -0.074891135758536093 -0.027499265797185785 -0.038545649464649272 0.037692845779979105 0.28940341175575296 0.24053618030119434 -0.073590235543477253 0.23582055597533952 -0.3000835731051818 0.061998265295773222 -0.30201123677616903 -0.20070726978885978 -0.28073017322967703 0.30494638345062502 -0.1986741090856417 -0.3924039122493081 0.28571638459849563 -0.19970376264062958 0.3263977468737046 0.26858194770840288 -0.12593480998082729 0.17911337674638036 0.28123318560454541 0.26578075356979503 -0.15425294457817917 0.16056934437409548 -0.090663890503794961 -0.28329503442816517 0.070460869933720943 -0.010747340372206468 -0.11928194131320502 -0.22742152528641396 -0.30818872113639539 -0.052726060433695002 -0.1086349079876157 -0.40860075883941294 -0.10286073569617836 0.17752123477283011 0.011304601770002391;-0.076343907944905101 0.092504466701440691 -0.054449967646983614 -0.18771651101564663 -0.39775026607190794 0.17939679228161873 -0.21841096344210084 0.15625814273703306 0.13545513270192061 -0.19833137165579309 0.028474288813492232 -0.17969113464327133 0.25700870071477572 -0.180695454942991 0.032902597383396806 0.15027345995321606 0.10231442579122828 -0.20404512731491734 0.26203349791574004 0.12667628482305951 0.14185496839495121 0.29997507732560175 0.29285840405768326 0.12644575597705404 -0.24528367089827732 -0.058130012397683062 -0.13308009697712181 -0.0072727975641252371 -0.20896076654913959 -0.026849069854632514 -0.15181965978557821 -0.28471923160929757 -0.085483066551344397 -0.29060428230080232 -0.065747218822173353 -0.053878236084818759 -0.31215488802937263 0.26682995933136172 -0.12653798386886805 -0.41256167069359129 0.22577446841592996 0.071597642950668519 -0.030857019162046171 -0.2279704219919495 0.12011524894042271 0.30123305955100627 -0.41635417009651504 0.24820872539563041 -0.20748589258546932;0.044684285937782051 -0.19750095010272722 -0.42158564152191019 -0.39981914316102252 -0.049822179198009284 0.10513893719183501 0.19302244055146955 -0.53087294493939186 0.17840230042056401 -0.27265780418423202 -0.20818088308665048 -0.092073548119218127 0.06732462515531823 0.07995059508038195 -0.22769402358022703 -0.21242533485525136 -0.11843459726638546 -0.080282127878399209 -0.15261241507631568 0.10265028513057578 -0.1885995449681408 0.32935357279211835 0.42182799815710115 0.23531777373621879 -0.142583264939319 0.42953002940285145 0.012796702269161514 -0.24033703435134432 -0.045070372713558196 0.060598408918497319 0.33587886657438987 -0.24422377702982212 -0.1537738952306574 0.1373685414941169 0.24566952886660948 0.050303507139438472 0.21889058116839732 -0.17146515717829905 -0.27207553619595159 -0.31777083252654537 -0.17467604387342206 0.3647376997415992 -0.23403345912430015 0.30722604427148215 -0.011773460212219493 -0.066169051217079111 -0.10113177632713892 0.10102507153947715 0.18513232796044587;0.2979736713548789 -0.25119374651635656 -0.51878486161662218 -0.013354321998110841 0.22971769849674303 -0.29832000950035253 -0.41667314016816065 -0.41974721579937574 -0.155424602229776 0.20354610201841453 0.08998319743637001 0.10115868838145362 0.31707625967717346 0.33964294094365249 -0.06042084446231176 -0.084936673247895167 0.17304437349841528 -0.23256648699882521 0.47233211227339239 0.27675347068699874 -0.087024849229348514 -0.33458869441974459 0.11793063438490754 -0.45865455538900252 0.034928891874176526 0.17874147968167978 -0.100216208606693 0.20918915744275082 0.19871432749044185 -0.036318237606297932 0.50033541718309638 0.074380577368109158 0.1751766466403652 0.16099137083934786 -0.054558138785405469 0.070924590500759818 0.61614944130180194 -0.34797176315222539 -0.18507474749588207 -0.21642474277509632 -0.28126915160860871 -0.1845050640649129 -0.23205337725594272 -0.038236970199831015 0.064498633977216613 -0.1112910138218549 -0.16473606675932831 0.26381414740673242 0.041373744491155662;-0.015781870206396219 -0.27136607946625929 -0.35333886660203812 -0.09727124576413762 0.16143460685135372 0.11469736163431792 -0.25416017606036068 0.020433328335831662 -0.2662843262093611 0.27725512758820869 -0.26609502012079445 -0.25180048581280284 0.11055461133148868 -0.33532823172654752 -0.21450881774538202 -0.37243052827385975 0.076160271501809623 0.31033568240039278 0.1514093865646603 -0.33900302897202095 -0.18538725259538966 -0.13564991845876156 -0.34196240164188557 0.26911491594640041 0.015283427755786845 0.32579736881043364 -0.082578633237396185 -0.36337353742227319 -0.35210033483580161 0.2051142500988179 0.015567960029824695 0.1761254489860363 0.24949262692008456 -0.086362080606499483 0.021412149236719399 0.022830259376885393 -0.087126016856818256 0.046807742635399691 -0.030344362215142185 -0.16857785998033972 0.097632277196126896 0.049030078400845861 -0.022779188942998983 0.25165121526506229 0.2529103914123253 -0.015471840125283264 -0.063448468761383506 -0.34468680416910286 -0.21912401835908446;0.013438420820439249 0.71903506595890232 0.51032144898263454 0.099994376498809906 0.13271229982092414 0.12286403136169771 0.53773881574428972 0.50548898114407548 0.15682331253623047 0.16602247765924893 -0.18700840131515301 -0.038486500705848345 0.11500292750507699 -0.30646495349352781 -0.30922236865867864 -0.3467988156647272 -0.36057327185626753 -0.41733647786801298 -0.32914007215850294 -0.47605640441530211 -0.13264080184274529 0.0041648530496280391 -0.39368789618846123 -0.058025549047320726 -0.28853326702266607 -0.2973806241510048 0.10936991140515444 0.010377753312217713 -0.51347651975610809 -0.012406562200311479 -0.51707619959341033 0.15316408588247618 0.14059934141025485 0.058731677284798549 -0.4951238783593751 0.18999035696002117 -0.35635403578918029 0.07770661327648011 -0.16284739026173278 0.46257742053955581 -0.098393799047027053 0.24583104494670008 0.26163326693431094 -0.13848606507950642 0.20086697257606584 0.10678051640014884 -0.044213746099821302 -0.0096221520668530302 -0.33295742547372215;0.29497854370718535 0.25867768114825246 -0.30052745172218215 0.097536721196869833 0.12865423852387853 -0.23938554970191039 -0.18534346415088915 0.13812493893183009 -0.12679251452637641 -0.27727232099561666 -0.04360974637510686 0.11996797402008655 -0.3120319663482059 0.17219536898240734 -0.30309565697598695 -0.31115455569741496 -0.26003679263901852 0.078408003194458065 0.23439241471098218 -0.25943003170408202 0.23407141742213197 -0.1873788651830583 -0.24368305014735023 -0.14346327439794557 -0.037761776088382708 -0.12395175349762429 -0.26702940125876251 0.066622451907721397 -0.11852566225245001 -0.092172126744960892 -0.12449962305942207 0.14049760399310074 0.20842265879306021 0.25879353530457982 -0.22619936639329313 -0.020948599219784959 -0.21894461504758542 -0.029063530311591201 -0.2723296334376652 0.14148376526740075 -0.22550915941822106 -0.0015655700965376133 0.12162394525305235 -0.2539717860672806 -0.31061323532394358 0.2790420951385208 0.12101944852471282 -0.32721754495274868 -0.32876684527398714;0.36878283898096698 0.60652685525177841 0.36148192685237196 0.52242747603324791 0.079831993875879373 0.17941207962483055 0.032718770006164279 0.59439981506256434 0.14480322312523564 0.37234675080506657 -0.16296311821148787 0.22488197213342895 0.0048858666020973763 -0.41657093946935431 0.09361445780192662 -0.26085138609756392 -0.44018868297688751 -0.38708609995976045 -0.54468981754924917 -0.45243250562063908 0.027670106389125648 0.2477522685205181 0.062692465800079741 0.12787044524436944 -0.14262400143660423 0.056524956019066701 0.17141922449529257 -0.031735016955716414 -0.37502847905852327 0.084160207551772101 -0.49514657956541613 0.15360415690655937 -0.049655810260362331 0.1502254986780622 0.023592650812911471 -0.15886800555335123 -0.25224686034997412 0.048662283531607939 -0.070790229836311183 0.19134235035051503 -0.13440683635652315 -0.18311449536229818 0.029636804448516199 -0.25761767795735679 0.36555084485781658 0.26934605083040231 -0.098830875857930323 -0.28727449679280775 -0.25442617803712503;0.31571092703383102 -0.15047526408781992 0.19094612545994694 -0.13643564362474234 0.0063033409824474257 0.02421970995162958 -0.058323268319263752 0.49627266580623441 -0.016385938487583712 -0.18131105530761599 0.31969845189471924 0.03546689430398714 -0.11106103566627802 -0.29099589535571818 0.10544568754813144 -0.3085054812035552 -0.3168926629142888 -0.31797353191214728 0.093441860756353287 0.20218239225078768 -0.12379168426517224 -0.077277398679048204 -0.304416328381441 0.39656672407488308 -0.13564322165440512 0.12153280313524491 -0.31038674601668798 -0.22257069546566088 0.027919936966445562 -0.1554122658103653 -0.37079934534909842 -0.30760737585033981 -0.27041097405892883 0.24438833709648114 -0.010650913428444972 0.34913141130988179 -0.03454588857857091 0.14352701151078279 0.12115218924572634 0.31297908507036487 -0.15162882280662771 0.0054137082006491359 0.29269435550543688 0.05058366578121732 0.27247481379689137 -0.020990624944264489 0.30060424216484144 -0.10544568044292522 -0.037731918686192495;0.15277203697129219 -0.33408466603637549 -0.31704114406713346 0.24687841755696724 0.33426220510642662 -0.34867046503573895 0.21949005439896346 -0.25798339037159018 0.082656711925042259 -0.039699461621559698 -0.021838764821658307 0.3051554948631261 0.070563142406425236 -0.16446875621660578 0.1294896145367932 -0.0070580309586650274 -0.00947760740678367 0.15014133130901056 0.26989822674060071 0.22406582002093697 0.17995043827208212 -0.28854793945106832 0.25130066663570105 0.05488520971275708 -0.4282858622807888 -0.11709026774826339 -0.020313795999756249 -0.25387060454324029 0.11480879655142492 -0.33283254057496608 0.19342341024325269 -0.24075646891115221 -0.015214348849144237 -0.097954186234120444 -0.089323071424006112 -0.058242710842275065 -0.024749797915452249 -0.099789368475359574 -0.048359312742380957 -0.0099067718552046657 -0.39862629331402971 0.0014986646312585906 0.31998483977831066 -0.054907056634374722 0.083291140015359075 0.25631220749293715 -0.20499522758261371 -0.24006156658771874 0.055886264812493702];

% Layer 2
b2 = [-0.34534345135317934;0.89574103303480102];
LW2_1 = [-0.80842272928336401 -0.68629875906555737 0.30840355304965322 0.52645231751822752 0.26118588248242958 -1.1382672250684871 0.068185946937010938 -1.3904088876195879 -1.1452806161816187 -0.61290542280940197;-0.6799621669269198 -0.50962927582588313 -0.9261786759198708 -0.82576072388571309 -0.56574153181057907 1.1641875723901505 -0.11642421439267021 0.71679233785710039 -0.16011332938002515 -0.45330633875999476];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    temp = removeconstantrows_apply(X{1,ts},x1_step1_keep,x1_step1_remove);
    Xp1 = mapminmax_apply(temp,x1_step2_gain,x1_step2_xoffset,x1_step2_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Remove Constants Input Processing Function
function y = removeconstantrows_apply(x,settings_keep,settings_remove)
if isempty(settings_remove)
    y = x;
else
    y = x(settings_keep,:);
end
end

% Competitive Soft Transfer Function
function a = softmax_apply(n)
nmax = max(n,[],1);
n = bsxfun(@minus,n,nmax);
numer = exp(n);
denom = sum(numer,1);
denom(denom == 0) = 1;
a = bsxfun(@rdivide,numer,denom);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
