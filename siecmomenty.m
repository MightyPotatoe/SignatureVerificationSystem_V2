function [Y,Xf,Af] = siecmomenty(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 17-May-2017 18:25:35.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 72xQ matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [0.731781438597027;-139678.09614045;-62239.9140073731;-106954.863445189;-424563769191.375;-365995910311.372;0.769465139513959;-309998.152735026;-577470178.512429;-6425.09667640742;62762.7789773799;-2316798423231.47;1.07778758989485;-4485926.55407378;-19508946308.4464;195947.555147309;-25831243726741.5;-901355927789698;0.74937883665408;-52782.9331624028;-51076509.6099448;-73619307.1910492;-139775847319.191;-1014310208.42636;1.23846924450643;-60466.8921875996;-615980.1160536;-47714830.8632129;-130800519909.082;-4640841708.73578;1.90279617071431;-3376524.6026747;329857.322133898;-542341.18210933;-231036747228803;-267910427845120;0.931429714534679;-187897.131185755;1379.35178144896;-1359031.86866998;-962778281548.234;-822692326486.95;0.835158776349684;-312742.726544549;-529350904.604398;-17088.8310491452;-7983077764.05214;-2701072107126.23;2.01137525600453;-6943041.79944395;-42148347027.3216;3051029.22338212;-31129869452185;-2.09491924236447e+15;1.25211725405646;-112351.40856667;-130502389.922978;-138822036.055864;-205089216251.817;-14102505.647775;0.764880443249321;-25211.3186642857;-108391.650824729;-35897088.7204232;-28439143784.4035;-400297998.559865;0.978773372676597;-1978380.83962529;-18018.309705546;-1521437.99323576;-88169321769615.4;-91339822495031.3];
x1_step1_gain = [0.362099955964268;1.42891939339708e-05;1.106702169099e-08;2.30226938683793e-08;4.70845183025985e-12;5.46435501877343e-12;0.332346314882759;6.45217318079605e-06;3.46338738953271e-09;6.33125138492855e-09;8.32645622590031e-13;8.63260185843262e-13;0.120038068348964;4.45937024276581e-07;1.02517554076088e-10;8.90894537642197e-11;1.20947353974031e-14;2.21887937055251e-15;0.387073109569554;3.75235375065871e-05;3.89865806990835e-08;2.71014285220916e-08;1.40672342440759e-11;1.47365321437939e-11;0.331882280561719;3.26764185642362e-05;2.16823172410909e-08;4.14849428382867e-08;1.51900404338812e-11;3.11281751293595e-11;0.1046714744894;5.9258344512117e-07;1.18978707830602e-10;2.10781947046607e-10;8.65663256934353e-15;7.46517842266818e-15;0.3324559588799;1.0647360186444e-05;5.71887334484742e-09;1.11555923905025e-08;2.07669777198781e-12;2.41322666826048e-12;0.334325977650236;6.39375535402124e-06;3.77796552722018e-09;6.21294222855509e-09;8.57400043612096e-13;7.40442897304534e-13;0.105584756812957;2.88353866332783e-07;4.74441917671232e-11;5.00885122358383e-11;4.99913725198616e-15;9.54689961975271e-16;0.327055970209877;1.7418715227591e-05;1.52907094860279e-08;1.42078675192976e-08;8.22340189858684e-12;3.29596926990056e-12;0.395686511044668;7.78672003449565e-05;8.7308865894471e-08;5.44857510781587e-08;7.00950520520508e-11;8.41563313536742e-11;0.119689168028534;1.01098329090608e-06;2.33471408022419e-10;4.37500573061781e-10;2.26836265788485e-14;2.1896149181682e-14];
x1_step1_ymin = -1;

% Layer 1
b1 = [1.5887386502122183;-0.88854922568745687;0.52302047878706581;-0.18382266505812311;0.7309068058754109;1.7765453061213849];
IW1_1 = [-0.10416556270687748 0.13110395321713011 -0.061040557610340093 0.23967784377431697 0.23607929966537941 -0.15230065977662091 -0.05720477510441669 0.042833838447808803 0.15042352713149607 -0.26043188890294577 0.062979140755953539 0.36004254679773218 0.13533810959508905 0.37034756798665636 -0.11420445918453492 0.021441936930766573 -0.42964814621168518 0.08996122812504416 -0.13197355447316489 0.25553935541009143 0.41115446399068689 0.20724904256081955 -0.18211888210332047 -0.047263216733648292 -0.041500808087682736 -0.36680837557484797 0.0021870949901010676 0.3884337331623845 -0.093657051255639764 -0.23625672906719156 -0.096785819294213676 -0.25354410102908376 0.21819124537254111 -0.070216083465317672 -0.041563640063552634 -0.097907510938244457 -0.32993512419365217 0.28918290960692894 -0.31829388408356946 -0.030890173527172583 -0.078465781420916786 0.3311536847463426 0.050305697992365478 -0.068802223344302929 -0.23144478854303141 0.17729797311621703 0.13522926825757428 0.012386796191304329 0.14046308217879724 -0.13817791317656836 -0.1542577303713327 0.20873238991217202 0.14516475597256306 -0.037488675556974618 -0.11546533655195848 -0.010407783829697334 -0.10893086024750562 0.18460703382506302 -0.1644770422356949 -0.28487123899356481 -0.091671085979833894 0.31652367360400041 -0.10812292443076081 0.21472478243599835 0.1946018139475853 -0.029939522451957079 0.03739583024186658 -0.33163201470371872 -0.21632697076736379 0.22194805308257165 -0.17138782846876746 0.28532157615622783;-0.079066730249337358 0.2179413769633724 0.10118392551445447 -0.065422420692398439 -0.027787249389483522 0.27782143095315442 -0.010896950095237678 0.13513798335536206 0.014874343628112231 0.13416584087365488 0.26734066819117552 -0.12416481047368876 -0.11256209729813213 -0.056262002624591856 0.049590656407543919 -0.0051295787420977384 -0.01554807668594128 -0.19839522402712204 0.25775326308765628 -0.34706980864136272 -0.081601630931400049 0.15612249705664119 -0.14729401806200476 0.25664886010793314 -0.12201752851717794 0.49718755255739672 -0.41863163235182604 -0.22804144403611007 -0.10370958733580754 -0.0020108956300312411 -0.23812625393273429 0.14413036924281453 -0.1562785601843614 0.1854701638323604 0.137227125917219 -0.073302967083070991 -0.11697739038333496 0.093627090731083579 0.27947032955024609 0.1901036683618039 -0.28367311509774468 -0.23733596906203436 -0.22123179507103899 0.36228537502624897 0.12885070948311528 -0.047068552274761574 -0.32306903545478838 -0.085551385615536935 -0.38297558430865813 0.53280491613095637 0.54277319104644106 -0.16693503629575712 -0.1294378672167634 0.33378764056938309 -0.37677244639325008 0.23042371872576983 0.28379109282110598 -0.056853518571008302 -0.044300151084696482 0.020947399743964576 0.14149574270424545 -0.171010933850922 -0.25253838514886057 0.39525757566704112 -0.098544121900581622 0.079102547516643487 0.0047158715477430974 0.35115349487744391 -0.53637143512444008 -0.24620291532282851 0.076330034233167213 0.079774243538843853;-1.0916620639618946 0.93638031026569613 -0.86772286402701537 -0.32815632950661239 0.32903879643415024 0.21853646244887504 0.31489762754088707 -0.53323157558041034 0.04016887175468168 0.49183579176482273 -0.077859018773341337 0.37613576675826366 0.36602667799014116 -0.47799126419921811 -0.0050947820260170418 0.41949295194181102 -0.34780112147511633 0.30685633602534146 0.041417309132312702 0.29131721157652918 -0.14763164971902107 0.65842708985339049 -0.37942612532496905 -0.37129895384062606 -0.3954702674617907 -1.058198285504574 0.7763012149197519 -0.26227092424907467 0.093048327060487046 -0.17415796157453611 0.24191869991479586 -0.3157348200654273 0.31485563409469397 -0.032374263764250344 0.051458445731967589 0.016666064742631017 -0.067058461863354735 -0.94301014931796945 0.26256370507894378 0.30819645996206951 0.42614781544608199 0.29935846838536068 -0.88444555180355111 0.347125671834565 0.034812026114828677 -0.41353335119186863 -0.034720271189427637 0.2003052211712999 0.060336334438785652 -0.47422726023093914 -0.26593935593977963 0.23343804046155978 0.035090854583720202 0.14968648030748327 -0.79387419577738016 -0.93869492010729083 0.31950993777638226 -0.55025845376732863 -0.37094258615531472 0.26639512006575627 -0.3201153281181105 0.67671480278622731 0.074680495813880282 -0.058350435976622643 -0.32539735471835479 -0.4984755868072856 0.18345376201698801 -0.32978098764365565 -0.027317578431365591 0.26835302424965535 0.27989261503335672 -0.10264916672410644;0.015310616140303287 0.3412789955369615 -0.18941399821539784 -0.19927340727265069 -0.21486394293928673 0.27271577460533536 -0.0091803240013365334 -0.17134864849616119 -0.14103809939119408 -0.18695795060235312 -0.28278735974648839 0.1227957493701417 -0.017568338085408901 -0.23273232477407876 0.11310457400369722 -0.060544255034881478 -0.15895735497613347 -0.1338049954926786 -0.16925815554913384 0.22988705709569085 0.26318148765755006 0.1401717758932951 0.070428263988518827 -0.20837506012858489 -0.044601455316822594 0.073249848406814116 -0.25375479570402371 -0.0082099063965791787 -0.19206965986777677 0.065075148904793254 0.010021837311313935 0.011156211473218103 -0.04022689865600821 -0.33187000518351584 0.28581270525798785 0.11757568116142594 -0.067126048770789204 -0.18753671551383996 0.006426844649391055 0.041832758359384395 -0.22611640308485187 0.1325528591251311 -0.033811980305272209 0.010630664507154886 0.058546418723833767 0.13554359161181545 -0.28384862405579275 -0.13062087867677513 0.1088228117840265 0.36956661379615197 -0.11682140928042287 -0.13930835654023499 -0.084952886350005696 0.082731302617677235 0.20862228072928107 -0.070739612993935663 0.34365460506178136 0.1933896652903575 0.37591712006658229 0.15017458927076244 0.24020844426844226 0.032141304582458216 -0.14886776291188678 -0.19634463156028972 0.10841779779826821 -0.2609620396868006 0.017026391201496557 0.036879314946888529 -0.37552776456707088 0.059000560929095849 0.023500720242542232 -0.085188043518148002;0.31372346877477936 0.17978564499578412 0.17355798001812645 -0.19091204076963214 -0.220247412445708 -0.1033969958971127 -0.083941849412816183 -0.065755041342952972 -0.055689858553419166 0.16989522826697884 0.25747998732381788 -0.032392247326930364 0.017838748192065251 -0.30321002267268826 0.11841786673128078 -0.043184316519690985 0.075503878853442979 -0.021597447880941398 0.036952597265548962 -0.011407243196521796 -0.21755933577971917 -0.45286309690163401 -0.32597082051485909 0.39333754710713109 0.16887612018146603 0.1489137026812781 -0.11437264357449176 -0.22564590877495636 0.24663634848520571 0.11121213636360702 -0.26649613472933997 -0.25054039409666817 -0.081459028439511 0.013948781775156113 -0.17134808430902121 -0.19108803596595289 -0.28413670240312333 0.21563494314307585 0.20848505752892826 -0.078919266341411026 -0.055437115509010849 -0.35243983525501388 0.15105667014664029 0.16423995610196648 0.0053401995807526477 -0.0071267402319505008 0.222323099112989 -0.35886507975688015 -0.14568466691121196 -0.19184937404187943 -0.035748581017718897 -0.15421864416714401 0.10377817587287962 -0.34628905720350972 0.011921535700080744 -0.20824232941092868 -0.090593824617644189 -0.053322288624201679 -0.26161758274061209 0.19667838792944844 0.15113402574724516 0.0059815882563596465 0.32887579850947679 -0.34399694722782581 -0.079740386867557508 -0.0038221226116499059 0.080782756202340544 0.11185256210424721 0.013181559152068936 -0.22577405126828198 -0.059067606376301457 0.10078550185777896;-0.13327208777551228 0.36352313877808445 -0.075463694322564445 -0.15373067974703969 0.2134162055801449 -0.20181086531324463 -0.1654202707421023 -0.51648319320745562 0.06757941721326928 0.2061953608544892 -0.46512770438251139 0.11814544688654627 0.51451633596637592 -0.32540391152035975 -0.44883439984276918 0.34842694259158097 -0.25071903798539202 0.080112958645561547 -0.21752035077654375 0.51054030195361377 -0.55167377428163034 0.58863238138673735 0.014165258542352177 -0.57996452634639883 -0.71787455123530775 -0.28828295813008881 0.36108586562955186 0.3394176434042433 -0.15326019584565906 -0.37284887965159819 -0.27350083883803078 -0.19981631484422432 -0.10120806059562587 0.06052032739269872 0.41322361878226482 0.13704517817554224 -0.45856145653733027 -0.34351527870500842 0.052003287397697169 -0.30696103547215359 0.072414125914035704 0.23744550717650201 -0.089988179185634842 0.059060614581418522 -0.026696429997392832 -0.02630111685212793 0.24130239001591486 0.18777474891976725 0.27083987654536129 -0.31077011926808029 -0.27353044066851234 0.44730370348952148 0.60146201456411752 0.077670878364261717 -0.16987397638560131 -1.0984339770354059 0.13428547400210938 -0.36960625791121954 0.20267796550172201 -0.14953280440709987 -0.033952657263203241 0.25743544376701111 0.40261307164320748 -0.01090462576422592 0.29841351421662932 0.0050632033631895432 0.12847066495603585 -0.30433262867331784 0.39651134242026209 0.28204239486691662 -0.34788600291570709 0.11689800564368059];

% Layer 2
b2 = [0.69703968375556469;0.98534444455525116];
LW2_1 = [-0.5628727449770119 0.84825977239365935 -2.0429159385278064 0.0034170907553044173 0.66818253976575115 -1.9822550094994944;1.1068807021275113 -1.27995819154779 2.8356408622186655 -0.36900939824281148 0.024423689255925245 2.232083609682491];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n)
nmax = max(n,[],1);
n = bsxfun(@minus,n,nmax);
numer = exp(n);
denom = sum(numer,1);
denom(denom == 0) = 1;
a = bsxfun(@rdivide,numer,denom);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
