function [Y,Xf,Af] = siec3(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 17-Jun-2017 13:42:00.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 96xQ matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_remove = [13 17 19 23 26 29 31 34 37 38 39 41 43 46 47 51 52 53 57 58 59 61 62 65 67 68 69 71 73 74 75 76 78 79 81 82 83 85 86 87 89 90 91 92 93 94 95];
x1_step1_keep = [1 2 3 4 5 6 7 8 9 10 11 12 14 15 16 18 20 21 22 24 25 27 28 30 32 33 35 36 40 42 44 45 48 49 50 54 55 56 60 63 64 66 70 72 77 80 84 88 96];
x1_step2_xoffset = [-0.0117507590503231;-0.00904298190487318;-0.00852631673890435;-0.0124089883933202;-0.0195738814026835;-0.0205782017297275;-0.0227715131082199;-0.0159710974182099;-0.0189532365431615;-0.0120875016058856;-0.00766958960824027;-0.0153520344360439;-0.0252288836545173;-0.0064308908294157;-0.0137488002227753;-0.0105485132750814;-0.0113903695209247;-0.0200299814299196;-0.0146443969585356;-0.0190377162430135;-0.00916525634406567;-0.0134710552544734;-0.0116434781916228;-0.0164387180498562;-0.021981494428948;-0.0213494352799942;-0.0153067561926803;-0.0229690439047997;-0.0141999115708368;-0.0144311538092064;-0.0126196938475087;-0.00829988871074131;-0.0189864475529495;-0.0126753416624528;-0.0101651568189208;-0.00930034955708254;-0.0141982082069303;-0.0237399956073195;-0.0171805870212477;-0.0115883728874302;-0.0156325191203169;-0.0171030006588394;-0.0303089741464796;-0.0147335713415574;-0.0186507417765633;-0.0217789687897993;-0.0251746846802024;-0.0267042593284223;-0.0207220892598081];
x1_step2_gain = [1.97677143516778;2.05214173549224;1.98309153346345;1.97548621449319;1.96160379986244;1.95967344453399;1.95547096723682;2.31116164400575;2.69446652886212;1.97611372220938;4.36303885918356;1.96976017397834;1.95078389995298;1.9872204025373;3.337377080817;1.97912319272848;1.97747581969498;1.96072668099061;2.90480011593305;2.17743176507738;1.98183596534572;1.97341600397045;1.97698106409496;1.96765428597329;2.2169986600102;2.17024705401626;1.96984801667216;1.9550933744444;1.9719978055434;1.97154828347884;1.9750751562029;1.98353686476877;2.3088129789528;2.04709272150077;1.97987426758822;1.98157069981961;1.97200111754874;1.95362104497395;1.96621919993271;1.97708875823799;1.96921619025382;1.96636918650764;1.94116527195818;1.97096070977118;1.9633814790258;2.51111752632408;1.95088703407058;1.95031097669817;1.95939719640077];
x1_step2_ymin = -1;

% Layer 1
b1 = [-1.576423448607734;-1.1884182513370807;0.89248667628592737;-0.72598858872863636;0.14186796048138936;-0.12746462295215338;0.10577183214550827;-0.70298648082434789;0.92984311026747613;0.76747901413235797;-1.9615489887326643];
IW1_1 = [0.224560397531432 -0.57169206675615147 0.016771799287082785 -0.31208229975972096 -0.3203233988702146 0.27106489013469687 0.0036408326778289068 -0.62335918204492813 -0.076172133554400417 -0.17391685082403069 0.22045115187991127 -0.25694126743408813 -0.37433465438142627 0.093627808945440649 0.19136455900246221 -0.1750157718402619 0.13267367550351125 0.37859069009028823 0.024293682348968428 0.022742442846527454 -0.1866655772621949 -0.18855653324718932 0.14855160550315422 -0.16748598042790497 -0.023345457026646591 0.17840140827350287 -0.36135242983341803 -0.42247278102159036 -0.15485950993136507 -7.6870632754400675e-05 0.37181756630021817 0.10836980402487466 -0.27541368258636723 0.026344845174525254 0.12446901855815728 0.015712384627326461 0.12374146824014916 0.042732480191894129 0.25349677583509123 0.045331497070048785 -0.12933884582267324 -0.26818944254872829 0.18831033855062843 0.30022348447239811 -0.1683563432723853 -0.22906083077185438 -0.093727907416777723 0.13188100944695982 -0.14259536507465284;0.29116712733622913 -0.250505440227067 0.11163202267344413 -0.14842065032880791 -0.14405199164466817 0.11878422406565944 -0.34639089395531747 -0.53549056737114875 0.28219495637575326 0.051033288645263915 0.2541144785116497 0.20917777102320237 0.27447432370156172 0.077432328729841238 -0.14464696873214053 -0.25310179806745486 -0.24716556495759998 0.028409661065844971 0.025331636769677621 -0.032806908151673225 0.15915397930160763 -0.41199841379281371 0.23209118161757486 -0.32877136027028631 0.041827220162530876 -0.050588484367578998 -0.17606089728229526 -0.10147195950968564 -0.24830359490898521 0.10006769911515205 -0.048260762993111148 -0.16220371061988614 0.044948744427621749 0.087029649498009343 0.26512307106023464 -0.26861767627646177 -0.14307048680447867 -0.25832720663816938 -0.15695110975151552 0.25743782333163806 -0.038752906425835405 0.22422831258484791 -0.4097239862096716 -0.15168337974205295 0.041291119945728136 -0.081972215428999226 -0.30895237849947793 0.12554037065966625 -0.27579032676133658;-0.20665541110419924 -0.20273967966847009 0.023755031355240274 0.22291812081519488 -0.092095403571122947 -0.23032146753495156 0.15641485234336633 -0.1652995007640943 -0.34628006273922968 -0.14206823145423861 0.0711567784647021 0.10011015673771027 -0.040572801791951767 0.31356703386168328 -0.022381926735194378 0.21472533308578803 0.074103807271844097 -0.15369683058274833 -0.16621037776531303 0.29305643601156578 -0.10505416153272687 -0.25802657067266133 0.3392418282349009 -0.29538685939993969 0.232859952900069 0.26269244470158082 -0.28532656041258392 -0.10936487986344319 -0.15640080612561269 -0.17376660081726905 0.26314537615613259 -0.28302724849291061 0.30033472734295258 0.050270853560926823 -0.010778015552219522 -0.086315467441235999 0.16902471863873864 -0.16925591274842006 -0.14643925840908112 -0.1120694244325276 0.31605139735762033 -0.22807078837536843 -0.34147430494932374 -0.31605525263691892 0.027499500616857978 -0.24575560683849912 -0.17658768446869749 -0.32473813698077408 -0.15984214796990484;0.14468160362403612 -0.34687355444992846 -0.42032873807941917 -0.11117752610473811 -0.095155339916490139 0.35475043144742285 0.060181984233108277 -0.25055147999533733 -0.11454384491578143 -0.015015644872128434 0.031544413758498438 -0.10173856018970125 0.26453652254286347 0.011761964093868617 0.078745454858113323 -0.049934999819886305 -0.045654404283256983 0.29209331523086873 0.42915862418874673 0.34807931242954354 0.22756532754160283 -0.043223341207835816 0.023431968098326608 -0.33304660305702039 -0.13202634159679513 0.46846952758689075 -0.061918398557403456 0.1859781725221242 0.020275998975533484 0.22731118995216767 0.42540790132291084 0.26748797235988819 0.16563199262061273 -0.36602297846946408 -0.13512293502195499 -0.090695135285659437 0.17383699076216119 -0.21384050707941132 -0.27431596490329974 -0.11823778083225266 -0.28246801125595528 -0.24818097752719645 0.026361518033876097 -0.17732601244827109 0.20162298413405577 -0.26494649961135225 -0.02635698478948437 0.091444243011598661 0.15271040233172356;-0.32312981967322751 -0.35629574032027223 0.21591885009663317 0.040044295499161227 0.23423844769421934 0.32992008408462414 -0.04664809972122276 0.089410675961084346 -0.27279026695646591 -0.29674662285663539 -0.2003711977077211 0.04192832117427666 -0.22772308986229731 -0.21909104289379583 0.055671256299378989 -0.053318780419961395 0.12668147250376108 -0.039400240994929892 -0.095165080698526319 0.47503110564240275 0.14704011376430559 -0.15554485867731516 -0.0565031974944303 -0.28957652350996166 0.20987029400726676 0.19688078569747994 -0.17584298570017887 0.21470823395548821 -0.073324149730025975 -0.066269666996735838 0.31561563111142937 -0.13385954784765339 0.38533837472271654 0.010889683106460463 0.11088588686874606 0.1823759421507064 0.32176225089128607 0.1690335726028496 -0.079440160453912737 -0.33035751932834939 0.24722833428158025 -0.11302668856997092 0.20176564735569738 0.088006051185059317 -0.35880516123326855 0.39536216729639412 -0.21851009195241866 -0.15079441553510059 -0.097452885960103292;0.27693487538318662 0.18281119099912554 -0.05699500638817457 0.070362418814283317 -0.16780336048855046 0.15722631844390692 0.14438943040925931 0.056142467050475243 -0.28746538044971698 -0.42436965872479482 0.23172307734483519 -0.21446523844459062 -0.098006759093810986 0.057098756319554939 -0.19182411244675646 -0.17271660277928561 0.20644786350916555 0.29714000042948713 -0.13200393674680486 0.4289900842788652 0.22724677618350997 -0.1328376663350011 0.1215994525559176 0.094219746098091361 0.22667061028908717 -0.044822972941195624 0.19378193470863672 -0.055465503336222424 0.31540852622757193 0.25343000092554729 0.2676122935146254 0.10122879531298415 -0.12215801555700771 -0.016561704610753496 -0.12346217795390672 -0.41187414026804137 -0.21704574867462925 -0.036771533062625032 -0.19866108961440698 -0.21677733522655487 -0.25832882840273785 0.18409565743209219 0.048326822606451859 0.18104800879848024 -0.340146470399734 -0.19346814997667738 -0.17360288698713902 -0.16295130709083305 0.29314103359482402;0.1661066464387746 -0.56194769755681229 0.038362032683083448 -0.48040779235041231 -0.3210188744180415 -0.21008094134207983 -0.3222526366045857 -0.24168696975768342 -0.14980173306659914 -0.33934747967355527 0.24872890421451574 -0.20881193972126752 -0.34945622920702046 0.09235178813764823 0.1686655652355126 0.28982756939955023 0.036945774723294543 -0.24884891035414608 0.35464393252574744 0.4623408703615518 0.15619205223190646 0.2358082280353429 0.14047683052940402 0.20729726337922388 -0.19919929086754495 0.37069909209936702 -0.3707596912178453 0.025521946277220941 0.3036592741129332 -0.16842781197351084 0.35210963925145361 0.14053457757978574 0.21735542057384569 -0.097852271568784011 0.19607035966905517 0.039984070636875001 0.51519636803885349 -0.070605664567887444 -0.16154794441494891 0.075332569139391264 -0.2606968952678117 -0.0667663801781435 0.17865516191002481 0.1857426425229346 -0.16132760471837213 0.30169124584467816 -0.084167965727082156 0.25187544852160082 -0.03068265054455473;-0.23997634697157197 -0.017650546974375531 -0.28533047450749038 0.23031447506492636 -0.18775295036986223 -0.25665821885791729 -0.1809781375835513 -0.008112978035531718 0.077789832908046655 -0.030774189233248303 0.12337336170031979 -0.29107334401459156 -0.21374529424261379 -0.068674641472647638 -0.10838472621234184 0.2781031703966198 -0.21914646816192015 0.00029535538716229871 0.071292017352181838 -0.15029781162530725 0.2154893315659038 0.1424507703764783 0.095111388170287844 -0.32152457195161643 0.1137430176807874 -0.067419568315591497 -0.19572792473252074 0.21447721651844084 -0.09456176838847867 0.11476299461674355 0.2371265270004182 0.11960669426404091 -0.22658780825130764 0.26538277665701976 0.38605286937650363 0.26193773910325979 0.22598210664915436 0.35845820535940492 -0.28635680093635968 -0.16779240971425796 0.23390337190005539 0.28558576054876977 -0.25934467232426572 0.087644043652509288 -0.41420235770447017 -0.034726640900124173 0.12653846019651929 -0.1344170235557012 0.28984959022643964;0.19586557225741258 0.20385604350086081 -0.24014255362104087 -0.063750692166057527 -0.2815480393435838 -0.21632372521852847 -0.18936224146680158 0.5065382856467282 0.20185409997656067 -0.084096721106619129 -0.14870458302623835 0.036939547049816619 0.12622114202915649 -0.0011205805466092539 0.062311596251575327 -0.26261698728836297 0.3789962936364436 -0.40176443180782856 -0.14831938139374354 -0.35398856240200988 -0.052502593345247227 0.14537527286718771 0.35582138906232497 0.14841714765091316 0.22468215559002883 -0.23098593091177502 -0.22527853015513352 0.056765452444048119 -0.16176512871086265 0.14318831840309962 -0.21681713601687358 0.088653940014801064 0.030894658574897937 0.2666883271395894 -0.15166496669237237 0.1006585973280183 -0.0020696474840935421 0.05598161051070321 0.39187646205460253 -0.12428344018240217 0.087161491259085608 0.44456619167407724 0.003009552473607261 -0.13358459067014958 0.047382469766878953 -0.22465569578580469 -0.042853965938708022 0.15100256239088783 0.3015693339308308;0.17804150942295388 -0.14956894518206448 -0.49508822129152386 -0.14584530306757448 -0.37877969363600011 -0.26548331143475262 -0.38865192955520667 -0.74897822651661805 -0.38098095958366368 -0.4579924586534927 0.51842872351798497 -0.074242740602898344 0.036932385628444711 0.46804144301095785 0.27821459459834158 0.13399011505141692 0.14705174801220289 -0.0050980759793853346 0.46775834765520402 0.17811005418362136 -0.17597469633240845 -0.16120725898398025 0.59665576371641305 -0.21944842702199768 0.037704845167427392 0.19838845294215679 -0.27774660119709177 -0.034912981666282511 0.38950005556343764 -0.17269335757124787 0.45832561244865777 -0.012800888008275391 0.53996806436660116 0.33875021088683954 0.04389808182432825 -0.36830724708813711 0.43976631448084191 0.35366272149921596 0.13410608419635833 0.086677467162250804 0.26442797465222695 -0.025654657487574842 -0.17484734675356664 0.39528779157175176 0.24357748711687599 -0.20628780860255994 -0.12476310033279775 -0.12017386771588984 0.20244498384564688;-0.18174149770675035 -0.56397623777668271 -0.59546803360642464 -0.67763723824143463 -0.10906514115922469 -0.083719340815438026 -0.44437516363030205 -0.72564453484924729 -0.16766986340988413 -0.83007134778746694 0.078452466127130124 0.014234631137131318 -0.13462266445707843 0.14653404662103078 0.055871340253255242 0.15211463085144103 0.27339458600321503 0.54760327543288223 0.45444157148849118 0.28739224151035542 0.028086623063574831 0.022866066115092322 0.16445565454033764 -0.1747288103315591 0.30964542921548843 0.67419658374395974 -0.20267717441629005 -0.19618313513166766 -0.032563234162474357 -0.33181778147271651 0.48992300552255641 0.28284535883311612 0.063467391711647156 0.10081208946643815 0.19479961164670023 -0.15435707102520388 0.41730687423855045 -0.11362034963834444 0.17749970615523386 -0.14370410714689857 -0.20453132991779049 -0.11446311703652307 -0.059073960212721446 -0.10626489373526599 -0.18672837419573693 -0.051288834022984647 0.19578399817756406 0.33268262715961638 0.024385265416249614];

% Layer 2
b2 = [0.51561835405159595;0.32916740038525927];
LW2_1 = [1.3394505283492224 0.047685307203668703 -1.1283312762909123 0.099787887566819652 -0.4519110777448026 0.49851937165419014 1.4614545958108451 0.42346332915454449 -0.61032661533845978 0.76746880845245224 1.7563977569379501;-0.29881912172641528 -0.71692629448075129 -0.67172031983958902 -1.1755870990795014 -1.0519564856482733 0.14934144830039045 -0.055416223959127764 -0.21234428046139453 0.16066002838907908 -1.0643182055264635 -1.6717909559718005];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    temp = removeconstantrows_apply(X{1,ts},x1_step1_keep,x1_step1_remove);
    Xp1 = mapminmax_apply(temp,x1_step2_gain,x1_step2_xoffset,x1_step2_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Remove Constants Input Processing Function
function y = removeconstantrows_apply(x,settings_keep,settings_remove)
if isempty(settings_remove)
    y = x;
else
    y = x(settings_keep,:);
end
end

% Competitive Soft Transfer Function
function a = softmax_apply(n)
nmax = max(n,[],1);
n = bsxfun(@minus,n,nmax);
numer = exp(n);
denom = sum(numer,1);
denom(denom == 0) = 1;
a = bsxfun(@rdivide,numer,denom);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
